
var distanceWidget,activeRoute=null,activeRoutes=null;var map,pano1,pano2;var geocodeTimer,markerDest,markerOrigin,directionLines=[];var profileMarkers=[],poly=[];var resultsArray={};var intervalStatus=false;var profileWindows=[],officeCoordinate,markerOffice,updateApiInterval;var GMStyle=[{featureType:"all",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"all",elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#000000"},{lightness:40}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#000000"},{lightness:16}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:17},{weight:1.2}]},{featureType:"administrative.country",elementType:"labels.text.fill",stylers:[{color:"#ff0000"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#c4c4c4"}]},{featureType:"administrative.neighborhood",elementType:"labels.text.fill",stylers:[{color:"#ff0000"}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#000000"},{lightness:21},{visibility:"on"}]},{featureType:"poi.business",elementType:"geometry",stylers:[{visibility:"on"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ff0000"},{lightness:"0"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.highway",elementType:"labels.text.stroke",stylers:[{color:"#ff0000"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#000000"},{lightness:18}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#575757"}]},{featureType:"road.arterial",elementType:"labels.text.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels.text.stroke",stylers:[{color:"#2c2c2c"}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#000000"},{lightness:16}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#999999"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#000000"},{lightness:19}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#000000"},{lightness:17}]}];$(document).ready(function(){officeCoordinate=new google.maps.LatLng(40.356806,49.980544);bakuCenter=new google.maps.LatLng(40.382158,49.840041);map=new google.maps.Map(document.getElementById("google-map"),{center:bakuCenter,zoom:14,zoomControl:true,key:"AIzaSyCq-_gXgDgF_UMGjjdPx8vRu2KA5Non2E4",styles:GMStyle,disableDefaultUI:true});poly=new google.maps.Polyline({map:map,strokeColor:"black",strokeWeight:7,});var g='<div id="officeInfoWindow" class="col bus-item"><div id="siteNotice" class="bus-inner-wrap"><div class="item-body"><h1 id="firstHeading" class="firstHeading">BakuBus MMC</h1><div id="bodyContent"><div class=""><div><strong>Email:</strong>&nbsp;<a href="http://mailto:info@bakubus.az/"><strong>info@bakubus.az</strong></a>.</div><div><br></div><div><strong>Hotline:</strong>&nbsp;*4242&nbsp; <strong>Office reception</strong><strong>:&nbsp;</strong>012 404 11 10</div><div class="clearfix"></div></div></div></div></div></div>';var f=new RichMarker({map:map,position:new google.maps.LatLng(40.353665,49.986616),content:g,visible:false,draggable:false,flat:true});f=new google.maps.InfoWindow({content:g,disableAutoPan:true});markerOffice=new google.maps.Marker({map:map,position:officeCoordinate,icon:new google.maps.MarkerImage("/assets/images/bakubus-marker2.png",null,null,null,new google.maps.Size(30,30)),zIndex:40,animation:google.maps.Animation.DROP,infoBox:f});markerOffice.addListener("click",function(){markerOffice.infoBox.open(map,this)});$(".selectpicker").selectpicker();var e=$(".sidebar-menu2 .banner-rotator .carousel");e.owlCarousel({itemsCustom:[[0,2]],navigation:true});var e=$(".menubar .banner-rotator .carousel");e.owlCarousel({itemsCustom:[[0,1],[406,1],[550,3]],navigation:true});getApi();updateApiInterval=setInterval(function(){if(intervalStatus){return}intervalStatus=true;getApi();intervalStatus=false},10000);$(".sidebar-menu .bus-search .method-change span a").click(function(h){h.preventDefault();$(".sidebar-menu .bus-search div.search-method").toggleClass("hidden");$(".sidebar-menu .bus-search "+$(this).data("target")).show()});$("form.navbar-form.closed button").on("click",function(h){if($(this).parents("form").hasClass("closed")){h.preventDefault();$("nav.navbar form.navbar-form.open input").val("")}else{}h.stopPropagation();$("nav.navbar form.navbar-form.closed input").focus();$(this).parents("form.closed").removeClass("closed").addClass("open")});$("form.navbar-form.closed input").on("click",function(h){h.stopPropagation()});$("html").on("click",function(h){$(".footer form.navbar-form.open input").val("").blur();$(".footer form.navbar-form.open").removeClass("open").addClass("closed")});$(".line-form form").submit(function(h){h.preventDefault();$(".search-method select").trigger("change")});$(".search-method select").change(function(k){activeRoutes=null;removeDirectionLines();markerDest.setMap(null);markerOrigin.setMap(null);var j=new google.maps.DirectionsService;var h=new google.maps.DirectionsRenderer;activeRoute=$(".search-method select option[value="+$(this).val()+"]").text();activeRoute=($(this).val()?activeRoute:null);removeRoutePathInfo();if($(this).val()){$.ajax({url:"/az/ajax/getPaths/"+$(this).val(),dataType:"json",context:$(this),success:function(l){h.setMap(map);if(l.Forward!==undefined){renderPath(l.Forward.busstops,"#7afbff",true,l.Forward.id)}if(l.Backward!==undefined){renderPath(l.Backward.busstops,"#CC99FE",false,l.Backward.id)}$(".bus-results").removeClass("bus-results__halfopacity");$(".bus-results .caption-distance .distance").html(l.Backward.length+" km");$(".bus-results .caption-buses .buses").html(countBusesByRoute(activeRoute)+" ədəd")}})}});$(document).on("click",".vacancies-item .btn-apply",function(h){h.preventDefault();$(".modal").modal("hide");$("#vacancyFormModal .input-subject").val($(this).parents(".vacancies-item").find("span").text());$("#vacancyFormModal .modal-body .nano").height($(document).outerHeight()-200-$("#vacancyFormModal .modal-header").outerHeight());$("#vacancyFormModal .modal-dialog").width($(document).width()-130-$(".sidebar-menu2").width());if($(document).outerHeight()>500){$(".nano").nanoScroller({destroy:true});$(".nano").nanoScroller({iOSNativeScrolling:true})}$("#vacancyFormModal").modal("show")});$(".search-method .form-control").click(function(h){$(".modal").modal("hide");$(this).focus()});$(document).on("click",".menubar .navbar-nav li a,.banner-rotator .item a,.search-content a",function(h){h.preventDefault();if($(this).data("keyword")!="contactus"&&$(document).outerHeight()>500){$("#contentModal .modal-dialog").width($(document).width()-130-$(".sidebar-menu2").width());$("#contentModal .modal-body .nano").height($(document).outerHeight()-200-$("#contentModal .modal-header").outerHeight())}toggleSearchBar();$.ajax({url:$(this).attr("href"),data:{ajax:1},dataType:"json",context:$(this),success:function(j){if($(this).data("keyword")!="contactus"){$("#contentModal .modal-header h1.modal-title").html(j.topic);$("#contentModal .modal-body .nano-content").html(j.content);if($("#virtualtour1").length){pano1=new pano2vrPlayer("virtualtour1");skin=new pano2vrSkin(pano1,"/assets/javascripts/pano2vr/");pano1.readConfigUrl("/assets/virtualtours/01/01_out.xml");setTimeout(function(){pano1.Ba("pano1")},1500)}if($("#virtualtour2").length){pano2=new pano2vrPlayer("virtualtour2");skin=new pano2vrSkin(pano2,"/assets/javascripts/pano2vr/");pano2.readConfigUrl("/assets/virtualtours/02/02_out.xml");setTimeout(function(){pano2.Ba("pano1")},1500)}if($(document).outerHeight()>500){$(".nano").nanoScroller({destroy:true});$(".nano").nanoScroller({iOSNativeScrolling:true})}$("#contactModal").modal("hide");$("#contactFormModal").modal("hide");$("#contentModal").modal({backdrop:"static",show:true})}else{$(".navbar-toggle").click();markerOffice.infoBox.open(map,markerOffice);map.panTo(officeCoordinate);$("#contactFormModal .modal-dialog").width($(document).width()-130-$(".sidebar-menu2").width());if($(document).outerHeight()>500){$(".nano").nanoScroller({destroy:true});$(".nano").nanoScroller({iOSNativeScrolling:true})}$("#contentModal").modal("hide");$("#contactModal").modal({backdrop:"static",show:true});$("#contactFormModal").modal({backdrop:"static",show:true})}},error:function(){alert("Error, please refresh")}})});$(".search-form form").submit(function(h){h.preventDefault();if($(this).data("keyword")!="contactus"&&$(document).outerHeight()>500){$("#contentModal .modal-dialog").width($(document).width()-130-$(".sidebar-menu2").width());$("#contentModal .modal-body .nano").height($(document).outerHeight()-200-$("#contentModal .modal-header").outerHeight())}$.ajax({url:$(this).attr("action"),data:$(this).serialize()+"&ajax=true",dataType:"json",context:$(this),success:function(j){$("#contentModal .modal-header h1.modal-title").html(j.topic);$("#contentModal .modal-body .nano-content").html(j.content);if($(document).outerHeight()>500){$(".nano").nanoScroller({destroy:true});$(".nano").nanoScroller({iOSNativeScrolling:true})}$("#contactModal").modal("hide");$("#contactFormModal").modal("hide");$("#contentModal").modal({backdrop:"static",show:true})},error:function(){alert("Error, please refresh")}})});$(".modal").on("shown.bs.modal",function(){$(".navbar-toggle").click()});$(".modal .modal-header button.close").on("click",function(){toggleSearchBar()});$("#contactModal").on("hide.bs.modal",function(){$("#contactFormModal").modal("hide")});$(".open-toggle").click(function(h){$(this).parent().toggleClass("open");$(this).parent().find("form").toggleClass("hidden-xs");$(this).parent().find("form").toggleClass("hidden-sm")});markerDest=new google.maps.Marker({map:map,anchorPoint:new google.maps.Point(0,-29)});markerOrigin=new google.maps.Marker({map:map,anchorPoint:new google.maps.Point(0,-29)});var b=(document.getElementById("destination"));var a=(document.getElementById("origin"));var d=new google.maps.places.Autocomplete(b,{componentRestrictions:{country:"az"}});d.bindTo("bounds",map);var c=new google.maps.places.Autocomplete(a,{componentRestrictions:{country:"az"}});c.bindTo("bounds",map);d.addListener("place_changed",function(){markerDest.setVisible(false);var j=d.getPlace();if(!j.geometry){window.alert("Autocomplete's returned place contains no geometry");return}if(j.geometry.viewport){map.fitBounds(j.geometry.viewport)}else{map.setCenter(j.geometry.location)}markerDest.setPosition(j.geometry.location);markerDest.setVisible(true);var h="";if(j.address_components){h=[(j.address_components[0]&&j.address_components[0].short_name||""),(j.address_components[1]&&j.address_components[1].short_name||""),(j.address_components[2]&&j.address_components[2].short_name||"")].join(" ")}});c.addListener("place_changed",function(){markerOrigin.setVisible(false);var j=c.getPlace();if(!j.geometry){window.alert("Autocomplete's returned place contains no geometry");return}if(j.geometry.viewport){map.fitBounds(j.geometry.viewport)}else{map.setCenter(j.geometry.location)}markerOrigin.setPosition(j.geometry.location);markerOrigin.setVisible(true);var h="";if(j.address_components){h=[(j.address_components[0]&&j.address_components[0].short_name||""),(j.address_components[1]&&j.address_components[1].short_name||""),(j.address_components[2]&&j.address_components[2].short_name||"")].join(" ")}});$(".direction-form form").submit(function(h){h.preventDefault();removeRoutePathInfo();$.ajax({url:"/ajax/getDirections",dataType:"json",jsonp:false,cache:true,data:{fromPlace:markerOrigin.position.lat()+","+markerOrigin.position.lng(),toPlace:markerDest.position.lat()+","+markerDest.position.lng(),},success:updateRouteSuggestion})})});function updateRouteSuggestion(b){colors={h1:"#ff0000",1:"#CA9E67",14:"#01FF52",2:"#662483",3:"#E6007E",5:"#01FEFF",6:"#FFFF0E",8:"#CD96FF"};distance=0;b=b.plan;removeDirectionLines();$(".bus-results .caption-buses .buses").html("");$(".bus-results .caption-distance .distance").html("");activeRoutes=[];for(i=0;i<1;i++){for(ii=0;ii<b.itineraries[i].legs.length;ii++){leg=b.itineraries[i].legs[ii];distance+=leg.distance;w=L.PolylineUtil.decode(b.itineraries[i].legs[ii].legGeometry.points);waypoints=[];for(iii=0;iii<w.length;iii++){waypoints.push({lat:w[iii][0],lng:w[iii][1]})}var a=new google.maps.Polyline({path:waypoints,geodesic:true,strokeColor:leg.mode=="WALK"?"#919191":colors[leg.route],strokeOpacity:1,strokeWeight:4,map:map});directionLines.push(a);if(leg.mode!="WALK"){activeRoutes.push(leg.route)}if(leg.mode!="WALK"){$(".bus-results .caption-buses .buses").append('<span class="bus-path"><span class="bus-prefix" style="background-color:'+colors[leg.route]+'"></span>'+leg.route+"</span>")}}}if(!activeRoutes.length){activeRoutes=null}$(".bus-results").removeClass("bus-results__halfopacity");$(".bus-results .caption-distance .distance").html(parseFloat(distance/1000).toFixed(2)+" km");getApi()}function removeDirectionLines(){for(i=0;i<directionLines.length;i++){directionLines[i].setMap(null)}directionLines=[]}function getApi(){intervalStatus=true;var a=$.ajax({url:"/az/ajax/apiNew",dataType:"json",}).done(function(b){addMarkers(b);delete b}).always(function(b){intervalStatus=false})}function removeRoutePathInfo(){for(i=0;i<busstopsMarker.length;i++){busstopsMarker[i].setMap(null)}busstopsMarker=[];for(i=0;i<poly.length;i++){poly[i].setMap(null)}poly=[]}function centerMap(){offset=-1*($(document).width()/2-($(document).width()-470)/2);if($(document).width()>1080){map.panBy(offset,0)}}function toggleSearchBar(){if($(document).width()<1080){$(".sidebar-menu2").toggle()}};